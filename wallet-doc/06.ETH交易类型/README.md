## 06.ETH交易类型

## 从交易标准来看

在以太坊网络中，随着需求和技术的发展，推出了多种不同的交易类型来优化交易体验、减少费用以及提升执行效率。

### 1. **Legacy 交易类型**（常用的传统交易类型）
- **引入时间**：以太坊创始时的交易类型，属于最早期的交易格式。
- **特点**：
  - **手续费高**：在 Gas 费模型中，用户需要手动设置 Gas 价格，导致在网络繁忙时，交易手续费非常高。用户往往会为了提高交易优先级而设置较高的 Gas 价格。
  - **交易执行效率低**：因为 Gas 费完全由用户指定，可能导致交易等待时间较长，尤其在网络拥堵时。交易无法被矿工快速打包，执行效率较低。
  - **无自动调整机制**：传统的 Gas 模型缺乏像 EIP-1559 中那样的动态调整机制，依赖用户的手动操作，容易导致费率设定不合理。

### 2. **EIP-1559 交易类型**（常用交易类型）
- **引入时间**：EIP-1559 于 2021 年的 **伦敦升级**中引入。
- **特点**：
  - **交易执行效率高**：EIP-1559 引入了一个新的 **基础费（Base Fee）** 模型，基础费根据网络的拥堵情况动态调整，使交易能够更加高效地进行处理。用户无需手动调整 Gas 价格，减少了 Gas 过高或过低的情况。
  - **可预测的费用结构**：基础费由网络计算，用户可以添加 **小费（Priority Fee）** 来增加交易被优先处理的可能性。这种机制避免了在网络拥堵时不必要的费用竞价，降低了不确定性。
  - **费用销毁机制**：EIP-1559 中的基础费在交易完成后被销毁，这引入了以太坊的通缩机制，减少了 ETH 的流通量。
  - **改善用户体验**：用户不再需要复杂的计算 Gas 费，可以更轻松地发起交易。

### 3. **EIP-2930 交易类型**（针对合约调用优化）
- **引入时间**：EIP-2930 于 **柏林升级** 中引入。
- **主要用途**：针对智能合约调用的优化。
- **特点**：
  - **访问列表（Access List）**：EIP-2930 引入了 **访问列表** 概念，允许用户预先声明交易过程中会访问的存储位置和合约地址。这减少了交易过程中与这些存储访问相关的 Gas 费用。
  - **合约调用效率提升**：通过预先指定的访问列表，减少了合约调用时访问存储的 Gas 消耗，提升了合约调用的效率，降低了执行复杂智能合约交易的成本。
  - **兼容性**：EIP-2930 兼容了 EIP-1559，但主要是为更高效地调用合约而设计，适合那些频繁与合约交互的复杂交易。

### 4. **EIP-4844 交易类型**（针对 Rollup 优化）
- **引入背景**：EIP-4844 针对 Layer 2 扩展解决方案，如 Rollups，进行优化，作为以太坊长期扩展计划的一部分。
- **主要用途**：为基于 **Rollup** 的 Layer 2 扩展方案提供交易数据处理和成本优化。
- **特点**：
  - **Proto-Danksharding**：EIP-4844 被视为引入 **Danksharding** 的前奏，Danksharding 是以太坊未来扩展计划的一部分，旨在提升网络处理能力。Proto-Danksharding 通过引入 **blob-carrying transactions（携带大块数据的交易）**，将 Rollup 数据存储在 Layer 1 上，但不会永久存储这些数据，降低了数据存储的压力。
  - **交易成本大幅下降**：EIP-4844 通过优化数据处理方式，显著降低了与 Rollup 相关的交易成本，使 Layer 2 扩展方案在以太坊主网上的运行更加高效和经济。
  - **提高可扩展性**：EIP-4844 提供了将 Rollup 交易与主网交易进行分离处理的机制，使得以太坊网络能够支持更多的交易和更高的吞吐量，解决主网的拥堵问题。
  - **为未来的分片做铺垫**：EIP-4844 是向分片技术（Sharding）过渡的重要一步，最终将大大提高以太坊网络的可扩展性。

### 总结
- **Legacy 交易类型**：传统交易类型，手续费高，用户体验较差。
- **EIP-1559**：常用交易类型，引入动态 Gas 费模型和费用销毁机制，提升了交易效率和可预测性。
- **EIP-2930**：为智能合约调用进行优化，减少复杂合约交互时的 Gas 消耗。
- **EIP-4844**：针对 Rollup 优化，降低 Layer 2 交易成本，提升可扩展性，为未来的分片技术做准备。

## 从业务类型看

* 从业务类型的角度，可以对以太坊上的不同交易进行分类，以下是各类交易的详细说明：

  ### 1. **创建合约交易**
  - **描述**：此类交易用于在以太坊上**部署智能合约**，交易数据中包含合约的字节码。与普通转账不同的是，这类交易并没有明确的接收地址，因为创建合约后，合约本身会生成一个唯一的合约地址。
  - **特征**：
    - 没有接收方地址，交易发起时接收地址为空（`null`）。
    - 交易数据部分包含要部署的合约字节码。
    - 交易成功后，以太坊网络会根据发起交易者的地址和 nonce 生成合约地址。
    - **Gas 消耗较大**：合约创建通常比普通转账需要更多的 Gas，因为涉及执行合约初始化代码。
    
  ### 2. **ERC20 Token 转账**
  - **描述**：ERC20 是最常见的以太坊代币标准，ERC20 转账意味着用户通过调用某个 ERC20 合约的 `transfer` 函数将代币从一个地址转移到另一个地址。
  - **特征**：
    - 交易会调用指定 ERC20 合约的地址，通常是 `transfer` 或 `transferFrom` 函数。
    - 交易数据部分包含调用的函数签名（如 `0xa9059cbb` 代表 `transfer(address,uint256)`），以及接收地址和转移的代币数量。
    - 与主币（ETH）转账不同，ERC20 转账需要额外消耗 Gas 用于执行智能合约。
    - **可编程性**：允许合约开发者在转账时加入逻辑控制，例如白名单、黑名单等。

  ### 3. **普通主币（ETH）转账**
  - **描述**：这是一种最常见的基础交易类型，用于在两个以太坊地址之间直接转移 ETH。交易只涉及 ETH，不涉及任何智能合约调用。
  - **特征**：
    - 发送方指定一个接收方地址，并附带一定数量的 ETH 作为转账金额。
    - 交易数据部分为空或仅包含简单备注（若有）。
    - **Gas 消耗较低**：与合约调用相比，普通转账的 Gas 消耗较少，因为没有复杂的代码执行。
    - 交易的唯一目的是转移 ETH，通常作为支付或转账用途。

  ### 4. **NFT 转账**
  - **描述**：NFT（Non-Fungible Token, 非同质化代币）基于 ERC721 或 ERC1155 标准，它们代表的是独特的数字资产，如数字艺术品、游戏道具等。NFT 转账意味着通过调用 NFT 合约中的函数，将某个 TokenID 对应的 NFT 从一个地址转移到另一个地址。
  - **特征**：
    - NFT 转账与 ERC20 类似，需要调用合约地址，但涉及到的函数是 ERC721 的 `safeTransferFrom` 或 `transferFrom`。
    - 交易数据部分除了包含接收方地址外，还包括特定的 `TokenID`，代表正在转移的独特 NFT。
    - **Gas 消耗较高**：NFT 转账通常比 ERC20 更复杂，因此 Gas 费也相对较高，尤其是当 NFT 附带复杂的元数据或逻辑时。
    - **唯一性**：NFT 的 `TokenID` 是唯一的，每个 NFT 都有独特的标识符，因此每次转账的是一个具体的资产，而非可替代的代币。

  ### 5. **内部交易（Internal Transactions）**
  - **描述**：内部交易指的是在一个智能合约内部执行的交易，这类交易不会直接出现在区块链的交易列表中，但可以通过区块链浏览器进行追踪。这些交易通常是由智能合约发起的对另一个合约或地址的转账或调用操作。
  - **特征**：
    - **隐式交易**：它们并非由用户发起，而是由合约代码调用生成的。例如，当一个合约调用另一个合约时，或者一个合约向某个地址发送 ETH。
    - **不可直接追踪**：内部交易不会像普通交易一样在区块链上直接显示，而是嵌套在由合约发起的外部交易中，必须通过交易执行的跟踪工具（如 Etherscan）查看。
    - **Gas 消耗取决于合约**：内部交易的 Gas 消耗与发起它们的合约执行逻辑有关，通常是由合约内部的逻辑决定的。
    - **常见场景**：智能合约的 ETH 自动分发、分红、调用其他合约时的交互等操作都属于内部交易。

  ### 总结

  | 交易类型         | 特点                                                         | 交易类型细节                                                 |
  | ---------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | **创建合约交易** | 部署合约，没有接收地址，合约字节码写入交易数据，Gas 消耗大   | 部署智能合约，生成合约地址。                                 |
  | **ERC20 转账**   | 调用 ERC20 合约的 `transfer` 函数，转移代币，消耗 Gas        | 使用合约转账代币，调用函数签名 `transfer(address,uint256)`。 |
  | **普通主币转账** | 简单的 ETH 转账，无合约调用，Gas 消耗低                      | 在地址之间转移 ETH，无需执行合约代码。                       |
  | **NFT 转账**     | 转移特定的 NFT `TokenID`，调用合约 `transferFrom`，消耗 Gas 比较高 | 转移 NFT，需指定 `TokenID`，可能使用 ERC721 或 ERC1155 标准。 |
  | **内部交易**     | 由合约发起的隐式交易，涉及合约间的交互，无法直接追踪         | 合约内部执行的调用、转账等操作，通过区块链浏览器追踪。       |

  每种交易类型都有其特定的用途和 Gas 消耗要求，具体的交易类型选择取决于业务需求。



